// src/ui/main-ui.js
import PlantBar from "./PlantBar.js";

const { createApp } = Vue;

const app = createApp({
  data() {
    return { selectedPlant: null };
  },
  components: { PlantBar }
});

const vm = app.mount("#app");

// â† ATTENDRE QUE LE DOM SOIT PRÃŠT
document.addEventListener('DOMContentLoaded', () => {
  console.log("DOM prÃªt, config drop...");
  
  const dropzone = document.getElementById("grid-dropzone");
  if (!dropzone) {
    console.error("âŒ #grid-dropzone NON TROUVÃ‰");
    return;
  }
  
  console.log("âœ… Dropzone trouvÃ©e:", dropzone);

  // â† FIX 1: EmpÃªcher tout pointer-events sur les enfants
  dropzone.style.pointerEvents = "auto";
  dropzone.style.background = "rgba(255,0,0,0.1)"; // â† DEBUG VISUEL (enlÃ¨ve aprÃ¨s)

  // â† FIX 2: Events avec VERROUILLAGE complet
  dropzone.addEventListener("dragover", e => {
    e.preventDefault();
    e.stopPropagation();
    e.dataTransfer.dropEffect = "copy";
    console.log("ðŸ”„ dragover !");
  }, false);

  dropzone.addEventListener("dragenter", e => {
    e.preventDefault();
    e.stopPropagation();
    console.log("âž¡ï¸ dragenter !");
  }, false);

  dropzone.addEventListener("dragleave", e => {
    console.log("â¬…ï¸ dragleave");
  }, false);

  dropzone.addEventListener("drop", e => {
    e.preventDefault();
    e.stopPropagation();
    console.log("ðŸ’¥ DROP !");

    const plantKey = e.dataTransfer.getData("plantKey");
    console.log("ðŸŒ± plantKey:", plantKey);

    if (!plantKey || !window.phaserPlaceUnit) {
      console.error("âŒ plantKey ou Phaser manquant");
      return;
    }

    const rect = dropzone.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    console.log("ðŸ“ x:", x, "y:", y, "w:", rect.width, "h:", rect.height);

    const rows = 5, cols = 5;
    const row = Math.floor(y / (rect.height / rows));
    const col = Math.floor(x / (rect.width / cols));

    console.log("ðŸŽ¯ row:", row, "col:", col);

    if (row >= 0 && row < rows && col >= 0 && col < cols) {
      window.phaserPlaceUnit(row, col, plantKey);
    }
  }, false);

  console.log("âœ… Dropzone configurÃ©e");
});
